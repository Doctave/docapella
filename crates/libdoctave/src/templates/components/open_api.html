{% from "components/markdown.html" import markdown %}

<div class="open-api-outer-container">
  <div class="open-api-inner-container">
    <div class="open-api-page-header">
      {% with breadcrumbs = page.breadcrumbs %}
          {% include "components/breadcrumbs.html" %}
      {% endwith %}

      <div class="prose open-api-tag-header">
        <h1>{{ page.ast.root.tag.name }}</h1>
      </div>

      {% if page.ast.root.tag.description_ast %}
        {{ markdown(page.ast.root.tag.description_ast) }}
      {% endif %}
    </div>

    <div class="open-api-operations">
      {% for operation in page.ast.root.operations %}
        <div class="open-api-operation">
          <div class="open-api-operation-header">
            <div>
              <span class="open-api-operation-method open-api-operation-method-{{ operation.method }}">{{ operation.method }}</span>
              <code class="open-api-operation-route-pattern">{{ operation.route_pattern }}</code>
            </div>
            <h2 id="{{ operation.anchor_tag }}">{{ operation.summary }}</h2>
          </div>

          {% if operation.description_ast %}
            {{ markdown(operation.description_ast) }}
          {% endif %}

          <div class="open-api-operation-inner">
            <div class="open-api-operation-inner-left">
              <!-- Request Body Section -->
              {% if operation.request_body %}
                <div class="open-api-section">
                  <h3 class="open-api-section-title">Request Body</h3>
                  {% if operation.request_body.description_ast %}
                    <div class="open-api-description">{{ markdown(operation.request_body.description_ast) }}</div>
                  {% endif %}
                  
                  {% for content in operation.request_body.media_types %}
                    <div class="open-api-media-type">
                      <h4 class="open-api-media-type-title">{{ content.name }}</h4>
                      {% if content.schemas %}
                        <div class="open-api-schema-container">
                          {% for schema in content.schemas %}
                            {% with schema = schema %}
                              {% include "components/open_api_schema.html" %}
                            {% endwith %}
                          {% endfor %}
                        </div>
                      {% endif %}
                    </div>
                  {% endfor %}
                </div>
              {% endif %}

              <!-- Parameters Section -->
              {% set all_params = [] %}
              {% if operation.query_params %}
                {% set all_params = all_params + operation.query_params %}
              {% endif %}
              {% if operation.header_params %}
                {% set all_params = all_params + operation.header_params %}
              {% endif %}
              {% if operation.path_params %}
                {% set all_params = all_params + operation.path_params %}
              {% endif %}
              {% if operation.cookie_params %}
                {% set all_params = all_params + operation.cookie_params %}
              {% endif %}
              {% if all_params %}
                <div class="open-api-section">
                  <h3 class="open-api-section-title">Parameters</h3>
                  <div class="open-api-parameters">
                    {% for param in all_params %}
                      <div class="open-api-parameter">
                        <div class="open-api-parameter-header">
                          {% if param.schema and param.schema.title %}
                            <span class="open-api-parameter-name">{{ param.schema.title }}</span>
                          {% endif %}
                          {% if param.schema and param.schema.required %}
                            <span class="open-api-parameter-required">required</span>
                          {% endif %}
                        </div>
                        {% if param.description_ast %}
                          <div class="open-api-parameter-description">{{ markdown(param.description_ast) }}</div>
                        {% endif %}
                        {% if param.schema %}
                          <div class="open-api-parameter-schema">
                            {% with schema = param.schema %}
                              {% include "components/open_api_schema.html" %}
                            {% endwith %}
                          </div>
                        {% endif %}
                      </div>
                    {% endfor %}
                  </div>
                </div>
              {% endif %}

              <!-- Responses Section -->
              {% if operation.responses %}
                <div class="open-api-section">
                  <h3 class="open-api-section-title">Responses</h3>
                  <div class="open-api-responses">
                    {% for response in operation.responses %}
                      <div class="open-api-response">
                        <div class="open-api-response-header">
                          <span class="open-api-response-status status-{{ response.code }}">{{ response.code }}</span>
                          <span class="open-api-response-description">{{ markdown(response.description_ast) }}</span>
                        </div>
                        
                        <!-- Response Headers -->
                        {% if response.headers %}
                          <div class="open-api-response-headers">
                            <h4 class="open-api-subsection-title">Headers</h4>
                            {% for header in response.headers %}
                              <div class="open-api-header">
                                <div class="open-api-header-info">
                                  <span class="open-api-header-name">{{ header.name }}</span>
                                  {% if header.schema and header.schema.required %}
                                    <span class="open-api-header-required">required</span>
                                  {% endif %}
                                </div>
                                {% if header.schema and header.schema.description_ast %}
                                  <div class="open-api-header-description">{{ markdown(header.schema.description_ast) }}</div>
                                {% endif %}
                                <div class="open-api-header-schema">
                                  {% with schema = header.schema %}
                                    {% include "components/open_api_schema.html" %}
                                  {% endwith %}
                                </div>
                              </div>
                            {% endfor %}
                          </div>
                        {% endif %}

                        <!-- Response Body -->
                        {% if response.media_types %}
                          <div class="open-api-response-content">
                            <h4 class="open-api-subsection-title">Response Body</h4>
                            {% for content in response.media_types %}
                              <div class="open-api-media-type">
                                <h5 class="open-api-media-type-title">{{ content.name }}</h5>
                                {% if content.schemas %}
                                  <div class="open-api-schema-container">
                                    {% for schema in content.schemas %}
                                      {% with schema = schema %}
                                        {% include "components/open_api_schema.html" %}
                                      {% endwith %}
                                    {% endfor %}
                                  </div>
                                {% endif %}
                                
                                <!-- Examples -->
                                {% if content.examples %}
                                  <div class="open-api-examples">
                                    <h6 class="open-api-examples-title">Examples</h6>
                                    {% for example in content.examples %}
                                      <div class="open-api-example">
                                        {% if example.name %}
                                          <div class="open-api-example-name">{{ example.name }}</div>
                                        {% endif %}
                                        {% if example.summary %}
                                          <div class="open-api-example-summary">{{ example.summary }}</div>
                                        {% endif %}
                                        {% if example.description %}
                                          <div class="open-api-example-description">{{ example.description }}</div>
                                        {% endif %}
                                        <pre class="open-api-example-code"><code>{{ example.value }}</code></pre>
                                      </div>
                                    {% endfor %}
                                  </div>
                                {% endif %}
                              </div>
                            {% endfor %}
                          </div>
                        {% endif %}
                      </div>
                    {% endfor %}
                  </div>
                </div>
              {% endif %}
            </div>
            <div class="open-api-operation-inner-right">
              <!-- Code Examples Section -->
              {% if operation.request_examples %}
                <div class="open-api-section">
                  <h3 class="open-api-section-title">Code Examples</h3>
                  {% for example in operation.request_examples %}
                    <div class="open-api-code-example">
                      <div class="open-api-code-example-header">
                        <span class="open-api-code-example-language">{{ example.name }}</span>
                      </div>
                      <pre class="open-api-code-example-code"><code>{{ example.value }}</code></pre>
                    </div>
                  {% endfor %}
                </div>
              {% endif %}
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
  </div>

  {% with footer = project.settings.footer %}
    {% include "footer.html" %}
  {% endwith %}
</div>
